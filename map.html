<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TipTheVerse â€” Ripples Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Drop a ripple pin at the city level and watch where clusters form." />

  <!-- Leaflet core -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <!-- Marker clustering -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <style>
    html, body { height: 100%; margin: 0; }
    body { background:#0b0f14; color:#e9f1fb; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif; }
    /* ðŸ‘‡ Critical: give the map a height or it wonâ€™t appear */
    #map { height: 100vh; width: 100%; }

    .topnav{
      position: sticky; top:0; z-index: 40; display:flex; gap: 18px; align-items:center;
      padding: 12px 6vw; background: rgba(11,15,20,0.85); backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .topnav a{ color:#e9f1fb; font-weight:600; text-decoration:none; }
    .spacer{ flex:1; }
  </style>
</head>
<body>

  <!-- Optional site nav to match your other pages -->
  <nav class="topnav">
    <a href="index.html">TipTheVerse</a>
    <a href="map.html" aria-current="page">Map</a>
    <a href="manifestation.html">Manifestation</a>
    <a href="give.html">Give</a>
    <div class="spacer"></div>
  </nav>
<section style="
  max-width:800px; margin:30px auto; padding:20px;
  background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.1);
  border-radius:14px; text-align:center; line-height:1.6; color:#e9f1fb;
">
  <h2>Drop Your Ripple âœ¨</h2>
  <p>
    Every time something good happens â€” big or small â€” you can mark it here.  
    Click on the map (or long-press on mobile) to drop a pin.  
    Each pin is anonymous and placed at the <strong>city level only</strong>, never your exact address.
  </p>
  <p>
    Why? Because when ripples gather in clusters, it shows the power of 
    <strong>shared intention</strong> and collective positivity.  
    One ripple in Phoenix is beautiful. Ten thousand ripples in Phoenix?  
    Thatâ€™s a wave ðŸŒŠ
  </p>
  <p style="color:#a9b8c9;font-size:0.9rem">
    Be mindful, keep it kind, and keep it anonymous. Together, we see how far good can travel.
  </p>
</section>

  <div id="map" role="region" aria-label="Ripples Map"></div>

  <script>
  // --- Init map
  const map = L.map('map').setView([39.5, -98.35], 4); // USA-ish center

  // Tiles
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
    attribution: '&copy; OpenStreetMap'
  }).addTo(map);

  // Cluster group
  const markers = L.markerClusterGroup();
  map.addLayer(markers);

  // --- Local demo markers (optional - keep or remove)
  const demo = [
    { name: 'Myrtle Beach, SC', coords: [33.6891, -78.8867] },
    { name: 'Philadelphia, PA', coords: [39.9526, -75.1652] },
    { name: 'Phoenix, AZ', coords: [33.4484, -112.0740] },
  ];
  demo.forEach(p => {
    const m = L.marker(p.coords).bindPopup(`<strong>${p.name}</strong><br/>Ripple felt here âœ¨`);
    markers.addLayer(m);
  });

  // --- Local storage helpers (per-visitor persistence)
  const LS_KEY = 'ttv_ripples_v1';

  function loadSavedPins() {
    try {
      const raw = localStorage.getItem(LS_KEY);
      return raw ? JSON.parse(raw) : [];
    } catch { return []; }
  }

  function savePins(pins) {
    try {
      localStorage.setItem(LS_KEY, JSON.stringify(pins));
    } catch {}
  }

  function renderSavedPins() {
    const pins = loadSavedPins();
    pins.forEach(({lat, lng, note}) => {
      const m = L.marker([lat, lng]).bindPopup(note || 'Ripple âœ¨');
      markers.addLayer(m);
    });
  }

  renderSavedPins();

  // --- Drop a pin on click (desktop)
  function addRipple(latlng) {
    // Keep it anonymous but allow a short note (optional)
    const note = prompt('Add an optional short note (or leave blank):', '');
    const m = L.marker(latlng).bindPopup((note && note.trim()) ? note.trim() : 'Ripple âœ¨');
    markers.addLayer(m);

    // Save for this visitor
    const pins = loadSavedPins();
    pins.push({ lat: latlng.lat, lng: latlng.lng, note: (note || '').trim() });
    savePins(pins);
  }

  map.on('click', (e) => {
    addRipple(e.latlng);
  });

  // --- Long-press to drop on mobile
  let pressTimer = null;
  let pressStartLatLng = null;

  function startPress(latlng) {
    pressStartLatLng = latlng;
    pressTimer = setTimeout(() => {
      addRipple(pressStartLatLng);
      pressTimer = null;
    }, 600); // long press = 600ms
  }
  function cancelPress() {
    if (pressTimer) { clearTimeout(pressTimer); pressTimer = null; }
  }

  map.on('mousedown', (e) => startPress(e.latlng));
  map.on('mouseup', cancelPress);
  map.on('mousemove', cancelPress);
  map.on('touchstart', (e) => {
    const first = e.latlng || (e.latlngs && e.latlngs[0]);
    if (first) startPress(first);
  });
  map.on('touchend', cancelPress);
  map.on('touchmove', cancelPress);

  // --- UI: Clear my pins
  const btn = L.control({position: 'topright'});
  btn.onAdd = function() {
    const div = L.DomUtil.create('div');
    div.innerHTML = `
      <button id="clearPinsBtn" style="
        cursor:pointer;padding:8px 12px;border-radius:10px;
        border:1px solid rgba(255,255,255,.2);background:rgba(11,15,20,.85);
        color:#e9f1fb;font-weight:600;backdrop-filter:blur(6px);
      ">
        Clear my pins
      </button>`;
    return div;
  };
  btn.addTo(map);

  // Stop the map from panning when clicking the button
  L.DomEvent.disableClickPropagation(document.getElementById('clearPinsBtn'));

  document.getElementById('clearPinsBtn').addEventListener('click', () => {
    // Remove only this visitor's saved pins
    localStorage.removeItem(LS_KEY);
    // Rebuild the cluster: remove all user markers and re-add demo
    markers.clearLayers();
    demo.forEach(p => {
      const m = L.marker(p.coords).bindPopup(`<strong>${p.name}</strong><br/>Ripple felt here âœ¨`);
      markers.addLayer(m);
    });
    // (If you donâ€™t want demo markers, delete the 3 lines above.)
  });
</script>

</body>
</html>




