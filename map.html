<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TipTheVerse â€” Drop a Pin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0a1130" />
  <meta name="description" content="Drop a pin to show where the ripple touched down." />

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin="anonymous"
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin="anonymous"
  ></script>

  <style>
    /* Base + mobile-safe sizing */
    html, body { height: 100%; margin: 0; background:#0a1130; }
    body {
      font-family: system-ui, Arial, sans-serif;
      color: #fff;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow: hidden; /* prevent sideways scroll on iOS */
    }
    #map {
      position: fixed; inset: 0;
      height: 100svh; /* mobile-friendly viewport */
      width: 100vw;
      z-index: 0;
    }

    /* Soft header */
    .topbar{
      position: fixed; top: env(safe-area-inset-top, 10px); left: 0; right: 0;
      display:flex; justify-content:center; pointer-events:none; z-index: 2;
    }
    .chip{
      pointer-events:auto;
      background: rgba(10,17,48,.65);
      border:1px solid rgba(255,255,255,.35);
      color:#fff;
      padding:10px 14px; border-radius:999px;
      margin: 8px auto 0;
      font-weight:800; letter-spacing:.2px;
      text-shadow: 0 1px 4px rgba(0,0,0,.5);
    }

    /* Floating toolbar (bottom) */
    .toolbar{
      position: fixed; left: 0; right: 0;
      bottom: calc(10px + env(safe-area-inset-bottom, 0px));
      display:flex; gap:10px; justify-content:center; flex-wrap:wrap;
      padding: 0 14px;
      z-index: 3;
    }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      min-height: 44px; padding: 12px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.45);
      background: rgba(255,255,255,.15);
      color: #fff; text-decoration:none; font-weight:800; letter-spacing:.2px;
      backdrop-filter: blur(2px);
      touch-action: manipulation;
    }
    .btn:hover{ background: rgba(255,255,255,.25); }
    .btn.primary{ background: rgba(0,160,255,.25); border-color: rgba(120,200,255,.8); }
    .btn.warn{ background: rgba(255,80,80,.22); border-color: rgba(255,160,160,.9); }

    /* Small help text */
    .hint{
      position: fixed; left: 0; right: 0; bottom: calc(60px + env(safe-area-inset-bottom, 0px));
      display:flex; justify-content:center; z-index:2; pointer-events:none;
    }
    .hint > span{
      pointer-events:auto;
      display:inline-block; padding:8px 12px; border-radius:12px;
      background: rgba(10,17,48,.55); border:1px solid rgba(255,255,255,.35);
      font-size: 12px; opacity:.95;
      text-shadow: 0 1px 3px rgba(0,0,0,.5);
    }

    /* Leaflet default control tweaks for mobile */
    .leaflet-control-zoom a { width: 38px; height: 38px; line-height: 38px; }
    .leaflet-control-attribution { display:none; } /* keep UI clean */
  </style>
</head>
<body>
  <div id="map" role="application" aria-label="Map to drop a pin"></div>

  <div class="topbar"><div class="chip">Drop a Pin where the ripple touched âœ¨</div></div>

  <div class="hint"><span>Tip: tap the map to drop a pin. Use â€œMy Locationâ€ first if you want.</span></div>

  <div class="toolbar" role="toolbar" aria-label="Map actions">
    <button id="locate" class="btn primary">ğŸ“ My Location</button>
    <button id="drop" class="btn">ğŸ“Œ Drop Pin Here</button>
    <button id="undo" class="btn">â†©ï¸ Undo</button>
    <button id="clear" class="btn warn">ğŸ§¹ Clear</button>
    <a href="index.html" class="btn">ğŸ  Home</a>
  </div>

  <script>
    // === Map init ===
    const map = L.map('map', {
      zoomControl: true,
      tap: true,         // mobile taps
      maxBoundsViscosity: 0.75
    });

    // World view, slight focus on US east
    map.setView([33.7, -78.9], 5);

    // Tiles (OSM)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    // === Pins state (persist in localStorage) ===
    const STORAGE_KEY = 'ttv_pins_v1';
    let pins = loadPins();
    const pinLayer = L.layerGroup().addTo(map);

    function loadPins(){
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
      catch(e){ return []; }
    }
    function savePins(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(pins)); }
    function redrawPins(){
      pinLayer.clearLayers();
      pins.forEach(p => L.marker([p.lat, p.lng]).addTo(pinLayer));
    }
    redrawPins();

    function addPin(latlng){
      pins.push({lat: latlng.lat, lng: latlng.lng, t: Date.now()});
      savePins();
      redrawPins();
    }

    // === UI actions ===
    document.getElementById('locate').addEventListener('click', () => {
      if (!navigator.geolocation) { alert('Location not available on this device/browser.'); return; }
      navigator.geolocation.getCurrentPosition((pos) => {
        const { latitude, longitude } = pos.coords;
        map.setView([latitude, longitude], 14, {animate: true});
        addPin({lat: latitude, lng: longitude});
      }, () => alert('Could not get your location. You may need to allow permission.'));
    });

    // Tap/Click to drop a pin
    map.on('click', (e) => {
      addPin(e.latlng);
    });

    // Drop pin at current center
    document.getElementById('drop').addEventListener('click', () => {
      addPin(map.getCenter());
    });

    // Undo (remove last pin)
    document.getElementById('undo').addEventListener('click', () => {
      pins.pop();
      savePins();
      redrawPins();
    });

    // Clear all
    document.getElementById('clear').addEventListener('click', () => {
      if (confirm('Remove all pins on this device?')){
        pins = [];
        savePins();
        redrawPins();
      }
    });

    // Improve touch usability: disable accidental page scroll while interacting
    document.addEventListener('touchmove', function(e){
      if(e.target.closest('#map')) e.preventDefault();
    }, {passive:false});
  </script>
</body>
</html>




